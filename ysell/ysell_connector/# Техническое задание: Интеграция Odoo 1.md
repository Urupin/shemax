# Техническое задание: Интеграция Odoo 17 с Ysell.pro

## 1. Цель проекта
Реализовать односторонний коннектор между Odoo 17 и Ysell.pro для автоматизации передачи подтверждённых заказов, отслеживания их доставки и создания складских перемещений.

## 2. Функциональные требования

### 2.1. Передача заказов в Ysell
- Заказ передаётся в Ysell только после подтверждения (при переходе в статус "sale").
- Передаются все необходимые для доставки поля: детали клиента-получателя, товары, количество, серийные номера, комментарии.
- Серийные номера передаются при создании заказа.
- В заказе указывается ID товара Odoo и ID товара Ysell (хранятся в Odoo).

### 2.2. Проверка статуса доставки
- Ежечасно (cron) проверять статус доставки всех заказов, отправленных в Ysell.
- Обрабатывается только статус "Done" (доставлен).
- При получении статуса "Done" в Odoo создаётся складское перемещение ShemaxGlobal → Покупатель в состоянии Draft.

### 2.3. Исключения
- Возвраты и частичные доставки не учитываются.
- Справочники продуктов и вариантов не синхронизируются, используются только существующие ID.

### 2.4. Логирование и уведомления
- Все обмены с Ysell логируются.
- Ошибки интеграции отображаются пользователю через уведомления.

## 3. Технические детали

### 3.1. Аутентификация
- Использовать API-ключ Ysell, хранить в настройках Odoo (ir.config_parameter).

### 3.2. Методы Ysell API
- **Создание заказа:** `POST /api/orders/create`
- **Проверка статуса заказа:** `GET /api/orders/status?id=...`
- **Работа с серийными номерами:** согласно [API Ysell](https://wiki.ysell.pro/doku.php?id=ru:serialnum)

### 3.3. Структура модуля
- `models/sale_order.py` — расширение sale.order для интеграции с Ysell.
- `services/ysell_client.py` — клиент для работы с Ysell API.
- `data/ir_cron.xml` — задачи по расписанию.
- `models/stock_picking.py` — создание складских перемещений.

## 4. Этапы реализации

1. Реализовать хранение и настройку API-ключа.
2. Реализовать методы клиента для работы с API Ysell.
3. Интегрировать вызовы клиента в бизнес-логику Odoo:
    - Передача заказа при подтверждении.
    - Проверка статуса доставки по расписанию.
    - Создание складского перемещения при доставке.
4. Реализовать логирование и уведомления.
5. Протестировать интеграцию на тестовом аккаунте Ysell.

## 5. Безопасность
- Все запросы к Ysell должны быть защищены (HTTPS).
- Не хранить ключи в открытом виде в коде.

---

**Для каждого метода интеграции требуется реализовать обработку ошибок и логирование.**
